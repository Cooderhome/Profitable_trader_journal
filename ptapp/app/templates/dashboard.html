{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block header %}Dashboard{% endblock %}

{% block content %}
<div class="grid grid-3" style="margin-bottom: 2rem;">
  <!-- Main Score Card -->
  <div class="card" style="grid-column: span 2; display: flex; align-items: center; justify-content: space-between;">
    <div>
      <h2 class="text-sm text-muted font-bold" style="text-transform: uppercase; letter-spacing: 1px;">Pro Trader Score
      </h2>
      <div style="font-size: 4rem; font-weight: 800; line-height: 1; margin: 0.5rem 0; color: var(--accent);">
        {{ total|int }}<span style="font-size: 2rem; opacity: 0.5;">%</span>
      </div>
      <p class="text-muted">Week of {{ week_start }}</p>
    </div>
    <div style="text-align: right;">
      <div class="text-sm text-muted">Performance Rating</div>
      <div
        style="font-size: 1.5rem; color: {{ 'var(--success)' if total >= 80 else 'var(--warning)' if total >= 50 else 'var(--danger)' }}; font-weight: 600;">
        {% if total >= 80 %}Excellent{% elif total >= 50 %}Average{% else %}Needs Work{% endif %}
      </div>
    </div>
  </div>

  <!-- Motivation -->
  <div class="card" style="display: flex; flex-direction: column; justify-content: space-between;">
    <div>
      <h3 class="text-sm text-muted font-bold mb-2">DAILY MOTIVATION</h3>
      <p style="font-style: italic; font-size: 1.1rem;">"{{ bible_verse }}"</p>
    </div>
    <div style="margin-top: 1rem;">
      <a href="{{ url_for('journal.new_journal_entry') }}" class="btn btn-primary"
        style="width: 100%; margin-bottom: 0.5rem;">Log Trade</a>
    </div>
  </div>

  <!-- Active Goal Widget -->
  <div class="card" style="{{ 'border: 1px solid var(--accent);' if goal else '' }}">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-sm text-accent font-bold" style="text-transform: uppercase;">ACTIVE PLAN</h3>
      {% if goal %}
      <span class="badge" style="background:var(--accent); color:white;">Running</span>
      {% else %}
      <a href="{{ url_for('planner.new_goal') }}" class="text-sm btn-outline">+ Set Goal</a>
      {% endif %}
    </div>

    {% if goal %}
    {% if goal.warning %}
    <div
      style="background: rgba(239, 68, 68, 0.2); border-left: 4px solid var(--danger); padding: 0.75rem; margin-bottom: 1rem; border-radius: 4px;">
      <strong style="color: var(--danger);">⚠️ WARNING</strong><br>
      <div class="text-sm">{{ goal.warning }}</div>
    </div>
    {% endif %}

    <div class="mb-1 text-xl font-bold">{{ goal.name }}</div>
    <div class="text-sm text-muted mb-4">Target: ${{ goal.target }} Profit</div>

    <a href="{{ url_for('planner.goal_detail', id=goal.id) }}" class="btn btn-outline btn-sm mb-4"
      style="width:100%;">View Full Details &rsaquo;</a>

    <div class="flex justify-between text-sm mb-1">
      <span>Progress (${{ goal.current }})</span>
      <span>{{ goal.progress }}%</span>
    </div>
    <div style="background: rgba(255,255,255,0.1); height: 10px; border-radius: 5px; margin-bottom: 1rem;">
      <div
        style="width: {{ goal.progress }}%; background: var(--accent); height: 100%; border-radius: 5px; transition: width 0.5s;">
      </div>
    </div>

    <div class="grid grid-2 text-sm" style="background:rgba(0,0,0,0.2); padding:0.5rem; border-radius:0.5rem;">
      <div>
        <div class="text-muted">Est. Trades</div>
        <div class="font-bold">{{ goal.trades_to_go }} left</div>
      </div>
      <div class="text-right">
        <div class="text-muted">Deadline</div>
        <div class="font-bold">{{ goal.deadline.strftime('%b %d') if goal.deadline else 'None' }}</div>
      </div>
    </div>
    {% else %}
    <p class="text-muted text-sm">No active trading plan. Create a plan to track your road to specific financial goals.
    </p>
    <a href="{{ url_for('planner.new_goal') }}" class="btn btn-outline" style="width:100%; margin-top:1rem;">Start a
      Plan</a>
    {% endif %}
  </div>
</div>

<h3 class="font-bold mb-4" style="font-size: 1.25rem;">Key Performance Indicators</h3>
<div class="grid grid-2">
  <!-- Journaling Score -->
  <div class="card">
    <div class="flex justify-between items-center mb-2">
      <span class="font-bold">Journaling Consistency</span>
      <span class="text-accent font-bold">{{ journaling }}%</span>
    </div>
    <div style="background: rgba(255,255,255,0.05); height: 8px; border-radius: 4px; overflow: hidden;">
      <div style="width: {{ journaling }}%; background: var(--accent); height: 100%; border-radius: 4px;"></div>
    </div>
  </div>

  <!-- Backtest Score -->
  <div class="card">
    <div class="flex justify-between items-center mb-2">
      <span class="font-bold">Backtesting Effort</span>
      <span class="text-accent font-bold">{{ backtest }}%</span>
    </div>
    <div style="background: rgba(255,255,255,0.05); height: 8px; border-radius: 4px; overflow: hidden;">
      <div style="width: {{ backtest }}%; background: var(--warning); height: 100%; border-radius: 4px;"></div>
    </div>
  </div>

  <!-- Risk Score -->
  <div class="card">
    <div class="flex justify-between items-center mb-2">
      <span class="font-bold">Risk Management</span>
      <span class="text-accent font-bold">{{ risk }}%</span>
    </div>
    <div style="background: rgba(255,255,255,0.05); height: 8px; border-radius: 4px; overflow: hidden;">
      <div style="width: {{ risk }}%; background: var(--danger); height: 100%; border-radius: 4px;"></div>
    </div>
  </div>

  <!-- Execution Score -->
  <div class="card">
    <div class="flex justify-between items-center mb-2">
      <span class="font-bold">Execution & Discipline</span>
      <span class="text-accent font-bold">{{ execution }}%</span>
    </div>
    <div style="background: rgba(255,255,255,0.05); height: 8px; border-radius: 4px; overflow: hidden;">
      <div style="width: {{ execution }}%; background: var(--success); height: 100%; border-radius: 4px;"></div>
    </div>
  </div>
</div>
{% endblock %}